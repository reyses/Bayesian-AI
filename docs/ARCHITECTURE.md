# Bayesian-AI — Architecture Reference
> Auto-generated by Jules on 2026-02-20. Do not edit manually.

## System Overview
Bayesian-AI is a multi-timeframe fractal trading system that leverages quantum field physics (the "Nightmare Field Equation") to model market structure and a Bayesian learning engine to identify high-probability patterns. It processes high-frequency tick data to compute "Three Body Quantum States" representing the gravitational interaction between price, support, and resistance.

The system operates in a continuous loop: **Discovery** (finding patterns), **Clustering** (grouping them into templates), **Optimization** (fitting parameters), and **Execution** (trading via a Belief Network). It features a "WaveRider" execution engine that manages positions with adaptive trailing stops and dynamic exit logic based on real-time belief updates.

## Phase Pipeline
| Phase | Name | File | Description |
|-------|------|------|-------------|
| 1 | Data Prep | `training/dbn_to_parquet.py` | Ingests Databento binary data, aggregates to 1s/15s bars. |
| 2 | Pattern Discovery | `training/fractal_discovery_agent.py` | Scans history for `ROCHE_SNAP` and `STRUCTURAL_DRIVE` events. |
| 2.5 | Clustering | `training/fractal_clustering.py` | Groups raw patterns into physically tight `PatternTemplate` centroids. |
| 3 | Optimization | `training/orchestrator_worker.py` | Fits regression models and optimizes TP/SL for each cluster. |
| 4 | Forward Pass | `training/orchestrator.py` | Simulates trading over the dataset using the learned playbook. |
| 5 | Strategy Selection | `training/orchestrator.py` | Ranks templates (Tier 1-4) based on risk-adjusted performance. |

## Core Files
| File | Class / Function | Role |
|------|-----------------|------|
| `core/quantum_field_engine.py` | `QuantumFieldEngine` | Computes physics (gravity, entropy, coherence) from price data. |
| `core/bayesian_brain.py` | `QuantumBayesianBrain` | Manages Bayesian probability tables and confidence scores. |
| `core/three_body_state.py` | `ThreeBodyQuantumState` | Frozen dataclass capturing the complete 16D fractal state. |
| `core/dynamic_binner.py` | `DynamicBinner` | Discretizes continuous features for O(1) Bayesian lookup. |
| `training/orchestrator.py` | `BayesianTrainingOrchestrator` | Central controller for the training/execution loop. |
| `training/fractal_clustering.py` | `FractalClusteringEngine` | Performs recursive K-Means clustering on feature vectors. |
| `training/timeframe_belief_network.py` | `TimeframeBeliefNetwork` | 8-layer worker cascade computing top-down path conviction. |
| `training/wave_rider.py` | `WaveRider` | Execution engine: manages stops, targets, and dynamic exits. |
| `training/fractal_dna_tree.py` | `FractalDNATree` | Hierarchical tree matching patterns to their ancestral context. |
| `visualization/live_training_dashboard.py` | `FractalDashboard` | Real-time UI for monitoring training and trade performance. |

## Key Constants & Parameters
- `TIMEFRAMES_SECONDS`: `[3600, 1800, 900, 300, 180, 60, 30, 15, 5, 1]` — The hierarchy monitored by the Belief Network.
- `MIN_CONVICTION`: `0.48` — Minimum belief conviction required to enter a trade.
- `MAX_CLUSTER_DISTANCE`: `4.5` — Max Euclidean distance to match a live pattern to a template.
- `TIGHTEN_TRAIL_FACTOR`: `0.92` — Multiplier to shrink trailing stop when wave is mature.
- `WIDEN_TRAIL_FACTOR`: `1.30` — Multiplier to expand trailing stop when conviction is high.
- `URGENT_EXIT_CONVICTION_THRESHOLD`: `1.01` — Threshold for urgent exits (effectively disabled).
- `R2_STOP_THRESHOLD`: `0.15` — Adjusted R² threshold to stop recursive cluster splitting.
- `BASE_RESOLUTION_SECONDS`: `15` — Base timeframe for simulation ticks.

## CLI Reference
Arguments for `training/orchestrator.py`:

| Flag | Default | Description |
|------|---------|-------------|
| `--data` | `DATA/ATLAS` | Path to data source (directory or parquet file). |
| `--iterations` | `1000` | Number of optimization iterations per template. |
| `--checkpoint-dir` | `checkpoints` | Directory for saving models and logs. |
| `--dashboard` | `False` | Launch full graphical dashboard. |
| `--no-dashboard` | `False` | Disable all UI elements. |
| `--fresh` | `False` | Clear previous checkpoints and start from scratch. |
| `--forward-pass` | `False` | Run Phase 4 simulation using existing library. |
| `--oos` | `False` | Run blind Out-of-Sample simulation (separate logs). |
| `--account-size` | `0.0` | Simulate funded account equity and margin rules. |
| `--min-tier` | `None` | Filter templates by Tier (1=Best, 4=Worst). |
| `--bias-threshold` | `None` | Oracle bias threshold for direction gating. |
| `--sweep-params` | `False` | Run post-hoc parameter sweep on trade logs. |
| `--strategy-report` | `False` | Run Phase 5 strategy selection and reporting. |

## Data Flow
```
Raw Data (Parquet)
       ↓
QuantumFieldEngine ──→ ThreeBodyQuantumState
       ↓
FractalDiscoveryAgent (Pattern Events)
       ↓
FractalClusteringEngine (Templates) ──→ PatternLibrary (Priors)
       ↓                                       ↓
TimeframeBeliefNetwork ────────────────→ BayesianBrain
       ↓                                       ↓
   WaveRider ◄────── (Execution) ─────── Orchestrator
       ↓
oracle_trade_log.csv ──→ Trade Analytics ──→ Reports
```

## Output Files
| File | Location | Description |
|------|----------|-------------|
| `oracle_trade_log.csv` | `checkpoints/` | Detailed log of every trade with oracle metadata. |
| `signal_log.csv` | `checkpoints/` | Log of all candidate signals and gate rejection reasons. |
| `phase4_report.txt` | `checkpoints/` | Summary report of the Forward Pass simulation. |
| `trade_analytics.txt` | `run_logs/` | Deep statistical analysis (ANOVA, Regression) of trades. |
| `pattern_library.pkl` | `checkpoints/` | The learned library of Pattern Templates (centroids & params). |
| `fractal_dna_tree.pkl` | `checkpoints/` | The hierarchical DNA tree structure. |
| `depth_weights.json` | `checkpoints/` | Learned weights for scoring patterns by fractal depth. |
| `production_playbook.pkl` | `checkpoints/` | Final set of Tier 1 strategies for deployment. |
